<ui:composition template="/templates/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="content">
	<style>
		.onlyDataDataList .ui-widget-content{
			border: none;
			background-color: rgba(0,0,0,0);
			list-style-type: none;
		}
		.onlyDataDataList .ui-widget-content .ui-datalist-data{
			list-style-type: none;
		}
		
		.selection{
			width:100%;
		}
		.selection td{
			float: left;
			width: 16%;
		}
	</style>
		<h:form id="clientsForm">
			<p:messages autoUpdate="true" />
			<p:dataTable var="client" value="#{clientsController.clients}"
				id="clientsDataTable" paginator="true" rows="20" lazy="true"
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
				tableStyle="table-layout: auto;" rowsPerPageTemplate="20,50,100">
				<p:column headerText="ID">
					<h:outputText value="#{client.id}" />
				</p:column>
				<p:column headerText="Nombre de Cliente">
					<h:outputText value="#{client.name}" />
				</p:column>
				<p:column headerText="Descripcion">
					<h:outputText value="#{client.description}" />
				</p:column>
				<p:column headerText="Usuarios">
					<p:dataList var="user" value="#{clientsController.getClientsUsers(client)}" styleClass="onlyDataDataList">
						#{user.username}
					</p:dataList>
				</p:column>
				<p:column headerText="Acciones">
					<p:commandButton value="Editar" icon="ui-icon-pencil"
						actionListener="#{clientsController.editClient(client)}" process="@this" update="@none" />
						<h:outputLabel value="&#160;&#160;|&#160;&#160;" />
					<p:commandButton value="Editar Usuarios"
						actionListener="#{clientsController.addUsers(client)}" process="@this" update="@none" />
						<h:outputLabel value="&#160;&#160;|&#160;&#160;" />
					<p:commandButton value="Activar Costos" rendered="#{not clientsController.getCostsActivated(client)}"
						actionListener="#{clientsController.activateCosts(client)}" process="@this" update="@form:clientsDataTable" />
					<p:commandButton value="Desactivar Costos" rendered="#{clientsController.getCostsActivated(client)}"
						actionListener="#{clientsController.deactivateCosts(client)}" process="@this" update="@form:clientsDataTable" />
				</p:column>

				<f:facet name="footer">
					<p:commandButton value="Agregar Cliente"
						actionListener="#{clientsController.addClient()}" process="@this" update="@none" />
				</f:facet>
			</p:dataTable>
			
			<p:dialog widgetVar="clientEditionDialog" id="clientEditionDialog" >
				<p:panelGrid>
					<p:row>
						<p:column>
							<h:outputLabel value="Nombre" />
						</p:column>
						<p:column>
							<h:inputText value="#{clientsController.clientToEdit.name}" />
						</p:column>


						<p:column>
							<h:outputLabel value="Descripcion" />
						</p:column>
						<p:column>
							<p:inputText value="#{clientsController.clientToEdit.description}"  />
						</p:column>
					</p:row>
				</p:panelGrid>
				<p:commandButton value="Guardar Cliente" actionListener="#{clientsController.saveClient()}" process="@form:clientEditionDialog" update="@none" />
			</p:dialog>
			
			<p:dialog widgetVar="userSelectionDialog" id="userSelectionDialog">
				<h:outputLabel value="Seleccione los usuarios que pueden ver el cliente: " />
				<p:selectManyCheckbox styleClass="selection" value="#{clientsController.selectedUsers}">
					<f:selectItems var="user" value="#{clientsController.posibleUsers}" itemValue="#{user.username}" itemLabel="#{user.username}" />
				</p:selectManyCheckbox>
				<p:commandButton actionListener="#{clientsController.saveSelectedUsers()}" value="Guardar Cambios" process="@form:userSelectionDialog" update="@none" />
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>
